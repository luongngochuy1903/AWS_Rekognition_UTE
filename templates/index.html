<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>AWS Rekognition Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { margin-top: 0; }
        .container { display: flex; gap: 20px; flex-wrap: wrap; }
        .column { flex: 1; border: 1px solid #ccc; padding: 20px; border-radius: 8px; box-shadow: 0 0 5px #aaa; min-width: 300px; }
        .column img { max-width: 100%; max-height: 200px; display: block; margin-bottom: 10px; }
        button { display: block; margin: 10px 0; padding: 10px 15px; font-size: 14px; cursor: pointer; }
        input[type="file"] { margin-bottom: 10px; }
        pre { background: #f7f7f7; padding: 10px; border-radius: 5px; max-height: 400px; overflow: auto; }
    </style>
</head>
<body>

<h1>AWS Rekognition Demo</h1>
<div class="container">

    <!-- C·ªôt 1: Ch·ªçn ·∫£nh & preview -->
    <div class="column">
        <h2>Ch·ªçn ·∫£nh</h2>
        <input type="file" id="image" accept="image/*">
        <img id="preview" src="" alt="Preview ·∫£nh">
        <input type="file" id="image_target" accept="image/*">
        <img id="preview_target" src="" alt="Preview ·∫£nh ƒë√≠ch">
        <input type="text" id="face_id" placeholder="Nh·∫≠p face ID:">
        
        
    </div>

    <!-- C·ªôt 2: C√°c API buttons -->
    <div class="column">
        <h2>G·ªçi API</h2>
        <button id="detect-labels">Detect Labels</button>
        <button id="recognise">Recognise Faces</button>
        <button id="compare-faces">Compare Faces</button>
        <button id="search-face">Search Face</button>
        <button id="search-user">Search User</button>
        <button id="search-user-by-image">Search user by image</button>

        <!-- üëá T√¢m th√™m c√°c n√∫t m·ªõi cho nh√≥m 1 & nh√≥m 2 -->
        <button id="detect-faces">Detect Faces</button> <!-- nh√≥m 1 -->
        <button id="recognize-celebrities">Recognize Celebrities</button> <!-- nh√≥m 1 -->
        <button id="detect-text">Detect Text</button> <!-- nh√≥m 2 -->
        <button id="detect-moderation-labels">Detect Moderation Labels</button> <!-- nh√≥m 2 -->
        <!-- üëÜ T√¢m th√™m xong -->

        <h3>K·∫øt qu·∫£</h3>
        <pre id="api-result">Ch∆∞a c√≥ k·∫øt qu·∫£</pre>
    </div>

    <!-- C·ªôt 3: Upload & Collection -->
    <div class="column">
        <h2>Upload & Collection</h2>
        <input type="file" id="image_upload" accept="image/*">
        <img id="upload-preview" src="" alt="Preview upload">
        <input type="text" id="name" placeholder="Nh·∫≠p t√™n">
        <input type="number" id="age" placeholder="Nh·∫≠p tu·ªïi">
        <button id="upload-s3">Upload l√™n S3</button>
        <h3>K·∫øt qu·∫£</h3>
        <pre id="upload-result">Ch∆∞a c√≥ k·∫øt qu·∫£</pre>
    </div>

</div>

<script>
    // ==== C·ªôt 1 ====
    let selectedFile = null;
    let targetFile = null;
    document.getElementById("image").addEventListener("change", (e) => {
        selectedFile = e.target.files[0];
        if (selectedFile) {
            const reader = new FileReader();
            reader.onload = (evt) => {
                document.getElementById("preview").src = evt.target.result;
            };
            reader.readAsDataURL(selectedFile);
        }
    });

    document.getElementById("image_target").addEventListener("change", (e) => {
        targetFile = e.target.files[0];
        if (targetFile) {
            const reader = new FileReader();
            reader.onload = (evt) => {
                document.getElementById("preview_target").src = evt.target.result;
            };
            reader.readAsDataURL(targetFile);
        }
    });

    async function sendFile(endpoint, extraData = {}) {
        if (!selectedFile) { 
            alert("H√£y ch·ªçn ·∫£nh tr∆∞·ªõc!"); 
            return; 
        }
        const formData = new FormData();
        formData.append("image", selectedFile);
        for (const [k, v] of Object.entries(extraData)) formData.append(k, v);

        const response = await fetch(endpoint, { method: "POST", body: formData });
        return await response.json();
    }

    // ====== C√°c n√∫t API ======
    document.getElementById("detect-labels").addEventListener("click", async () => {
        const result = await sendFile("/detect");
        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });

    document.getElementById("recognise").addEventListener("click", async () => {
        const result = await sendFile("/recognise"); // SearchFacesByImage
        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });

    document.getElementById("compare-faces").addEventListener("click", async () => {
        if (!selectedFile ) {
            alert("Vui l√≤ng ch·ªçn ·∫£nh ngu·ªìn so s√°nh!");
            return;
        }
        if (!targetFile) {
            alert("Vui l√≤ng ch·ªçn ·∫£nh ƒë√≠ch ƒë·ªÉ so s√°nh!");
            return;
        }

        const formData = new FormData();
        formData.append("image", selectedFile);
        formData.append("image_target", targetFile);

        const res = await fetch("/compare", { method: "POST", body: formData });
        const result = await res.json();

        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });

    // ====== SearchFaces (theo FaceId) ======
    document.getElementById("search-face").addEventListener("click", async () => {
        const faceId = document.getElementById("face_id").value.trim();
        if (!faceId) { alert("H√£y nh·∫≠p FaceId tr∆∞·ªõc!"); return; }

        const formData = new FormData();
        formData.append("face_id", faceId);

        const res = await fetch("/search_face", { method: "POST", body: formData });
        const result = await res.json();
        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });

    // ====== SearchUsers (theo FaceId) ======
    document.getElementById("search-user").addEventListener("click", async () => {
        const faceId = document.getElementById("face_id").value.trim();
        if (!faceId) { alert("H√£y nh·∫≠p FaceId tr∆∞·ªõc!"); return; }

        const formData = new FormData();
        formData.append("face_id", faceId);

        const res = await fetch("/search_users", { method: "POST", body: formData });
        const result = await res.json();
        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });

    // ====== SearchUsersByImage (·∫£nh m·ªõi) ======
    document.getElementById("search-user-by-image").addEventListener("click", async () => {
        const result = await sendFile("/search_users_by_image");
        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });

    // üëá T√¢m th√™m ph·∫ßn g·ªçi c√°c API m·ªõi
    document.getElementById("detect-faces").addEventListener("click", async () => {
        const result = await sendFile("/detect-faces");
        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });

    document.getElementById("recognize-celebrities").addEventListener("click", async () => {
        const result = await sendFile("/recognize-celebrities");
        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });

    document.getElementById("detect-text").addEventListener("click", async () => {
        const result = await sendFile("/detect-text");
        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });

    document.getElementById("detect-moderation-labels").addEventListener("click", async () => {
        const result = await sendFile("/detect-moderation-labels");
        document.getElementById("api-result").textContent = JSON.stringify(result, null, 2);
    });
    // üëÜ K·∫øt th√∫c ph·∫ßn T√¢m th√™m

    // ==== C·ªôt 3 ====
    let selectedUploadFile = null;
    document.getElementById("image_upload").addEventListener("change", (e) => {
        selectedUploadFile = e.target.files[0];
        if (selectedUploadFile) {
            const reader = new FileReader();
            reader.onload = (evt) => {
                document.getElementById("upload-preview").src = evt.target.result;
            };
            reader.readAsDataURL(selectedUploadFile);
        }
    });

    async function sendUploadFile(endpoint) {
        if (!selectedUploadFile) {
            alert("H√£y ch·ªçn ·∫£nh tr∆∞·ªõc!");
            return;
        }
        const name = document.getElementById("name").value.trim();
        const age = document.getElementById("age").value.trim();

        const formData = new FormData();
        formData.append("image_upload", selectedUploadFile);
        formData.append("name", name);
        formData.append("age", age);

        const response = await fetch(endpoint, { method: "POST", body: formData });
        return await response.json();
    }

    document.getElementById("upload-s3").addEventListener("click", async () => {
        const result = await sendUploadFile("/upload");
        document.getElementById("upload-result").textContent = JSON.stringify(result, null, 2);
    });
</script>

</body>
</html>
